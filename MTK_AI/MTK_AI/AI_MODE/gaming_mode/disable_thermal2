#!/system/bin/sh

# Disable thermal throttling aggressively — MTK-focused
# Run as root!

LOG_TAG="MAX_PERF_THERMAL"

log() {
    echo "[$LOG_TAG] $1"
}

log "Disabling thermal throttling..."

# Common thermal control paths (MTK + AOSP)
for node in \
    /sys/class/thermal/thermal_message/* \
    /sys/class/thermal/cooling_device*/cur_state \
    /sys/class/thermal/cooling_device*/max_state \
    /sys/class/thermal/thermal_zone*/mode \
    /sys/class/thermal/thermal_zone*/policy \
    /sys/class/thermal/thermal_zone*/trip_point_*_temp \
    /sys/devices/virtual/thermal/thermal_message/* \
    /sys/devices/virtual/thermal/cooling_device*/cur_state \
    /sys/devices/virtual/thermal/thermal_zone*/mode \
    /proc/mtk_thermal \
    /proc/.mtk_thermal \
    /sys/kernel/debug/mtk_thermal \
    /sys/devices/platform/mtk_ts_cpu/enable \
    /sys/devices/platform/mtk_ts_cpu/hot_threshold \
    /sys/devices/platform/mtk_ts_cpu/cold_threshold \
    /sys/devices/platform/mtk_ts_battery/enable \
    /sys/devices/platform/mtk_ts_skin/enable \
    /sys/devices/platform/mtk_ts_AP/enable \
    /sys/class/power_supply/battery/thermal_input \
    /sys/class/power_supply/battery/thermal_limit \
    /sys/class/misc/mediatek/thermal/* \
    /sys/module/mtk_cooler/* \
    /sys/module/thermal_core/*; do

    if [ -w "$node" ]; then
        case "$node" in
            */mode)
                echo "disabled" > "$node" 2>/dev/null && log "Disabled $node"
                ;;
            */cur_state|*/max_state)
                echo "0" > "$node" 2>/dev/null && log "Set $node = 0"
                ;;
            */trip_point_*_temp)
                # Set trip points to extreme values (e.g., 120°C = 120000 mC)
                echo "120000" > "$node" 2>/dev/null && log "Raised trip point: $node"
                ;;
            */enable)
                echo "0" > "$node" 2>/dev/null && log "Disabled sensor: $node"
                ;;
            /proc/mtk_thermal|/proc/.mtk_thermal)
                echo "0" > "$node" 2>/dev/null && log "Disabled MTK thermal daemon interface"
                ;;
            *)
                # Try to zero out unknown writable nodes safely
                echo "0" > "$node" 2>/dev/null && log "Zeroed $node"
                ;;
        esac
    fi
done

# Kill thermal daemons if present (common on MTK)
for proc in thermal_manager thermalloadalgod mtk_thermal daemon_thermal; do
    pkill -f "$proc" 2>/dev/null && log "Killed thermal process: $proc"
done

# Optional: Disable battery thermal input (may allow charging while hot)
if [ -w /sys/class/power_supply/battery/thermal_input ]; then
    echo "25" > /sys/class/power_supply/battery/thermal_input 2>/dev/null
fi

log "Thermal throttling fully disabled. Max performance mode active."
